## これはWicon2023に使用する、流れのマップを生成するプログラムです。
## 概要 
このプログラムでは、海域の流れのベクトルをマップ化によって可視化する。本システムでは当初、海域内に多くのセンサを設置し、可視化処理を行っていたが、このプログラムにより少ない実データ数で海域内全ての地点の流れベクトルを算出・可視化が可能である。
## プログラムの説明
1. get_flow_sensor()は、センサの個数分実行される。センサで取得したデータをWebページ上からスクレイピングし、stock_dataに格納。内容は[取得時刻,センサ番号,x軸,y軸,電圧値]である。戻り値は、取得したstock_dataからセンサの座標の傾きである。

2. get_vector()では、get_flow_sensor()で取得したセンサの実データから、残りの地点の流れをベクトル和によって算出する。 vx[i,j] += ov_x[k] / dis  では、算出地点のベクトルが、実データの地点の距離と反比例するように加算されていく。これによって、実データ地点に近いほど、算出における影響が高くなる。戻り値はvx,vyを要素数=算出地点数のリストとして返す。


3. draw_map()では、get_flow_sensor及びget_vector()で算出された、海域全体の流れのベクトルを可視化するものである。センサで取得した実データ地点は赤、残りの算出によって得られた地点は青で表現されている。


4. ov_rip_current()では、海域全体のベクトルの向きを監視し続ける。全地点のベクトルの向きを算出し、detected_ripによってある角度thred_rip1より大きいものだけを加算し、最終的に地点数で割ることで海域全体の平均のベクトル向きを求める。この平均のベクトルの角度が設定した閾値thred_rip2より大きいと"Alert rip current"と警告する。
   
## 手順


1.プログラムを実行するpcと受信機側のM5Stackをアクセスポイントに接続 


2.センサ側のM5Stackで収集したデータがWebページ上で表示されているか 192.168.1.1234/envで確認


3.flow.pyを実行して、以下のような画像が表示されれば成功
![Figure_1](https://github.com/Jikkoke/jikkoke/assets/129914983/aebce611-8d13-4811-ac28-704e73eab14a)

参考資料
[https://www.profuture.co.jp/mk/column/51055](https://qiita.com/sci_Haru/items/21777764ae50996abd95)

[https://zenn.dev/wkb/books/node-tutorial](https://plantprogramer.com/quiver_matplotlib/)

